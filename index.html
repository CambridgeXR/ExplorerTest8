<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VR Explorer</title>

<link rel="manifest" href="/ExplorerTest8/manifest.json">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="VR Explorer">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="/ExplorerTest8/icons/icon-192.png">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    text-align: center;
}
.container {
    margin-top: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
h1 { font-size: 2.8rem; margin-bottom: 10px; }
h2 { margin-top: 20px; font-size: 1.6rem; font-weight: 600; }
label { display: block; margin-top: 15px; font-size: 1rem; color: #dfeeff; text-align: center; }
select { width: 80%; max-width: 350px; padding: 14px; margin-top: 6px; font-size: 1.2rem; border-radius: 10px; border: none; outline: none; background: #111; color: white; appearance: none; cursor: pointer; background-image: linear-gradient(45deg, transparent 50%, #555 50%), linear-gradient(135deg, #555 50%, transparent 50%), linear-gradient(to right, #555, #555); background-position: calc(100% - 20px) calc(1.2em), calc(100% - 15px) calc(1.2em), calc(100% - 2.5em) 0.5em; background-size: 6px 6px, 6px 6px, 1px 1.5em; background-repeat: no-repeat; }
.or-text { margin: 12px 0; font-size: 1rem; color: #dfeeff; }
button#openBtn { margin-top: 12px; padding: 15px 25px; font-size: 1.3rem; color: #fff; border: none; border-radius: 12px; cursor: pointer; width: 80%; max-width: 350px; background-color: #555; }
button#openBtn.active { background-color: #28a745; }
footer { margin-top: 40px; font-size: 0.75rem; font-style: italic; opacity: 0.8; margin-bottom: 20px; }

#playerWrap { position: fixed; inset: 0; display: none; background: #000; z-index: 1000; align-items: center; justify-content: center; flex-direction: column; }
#playerWrap iframe { width: 100%; height: 100%; border: 0; }

#safeModeToggle { display: flex; align-items: center; justify-content: center; margin-top: 15px; }
#safeModeToggle input { margin-left: 8px; transform: scale(1.2); }
</style>
</head>
<body>

<div class="container" id="home">
    <h1>VR Explorer</h1>
    <h2>Step 1: Select Simulation</h2>

    <label for="audienceSelect">Audience Sizes:</label>
    <select id="audienceSelect"></select>

    <div class="or-text">or</div>

    <label for="scenarioSelect">Special Scenarios:</label>
    <select id="scenarioSelect"></select>

    <h2>Step 2: Enter Simulation</h2>
    <button id="openBtn">Go</button>

    <div id="safeModeToggle">
        <label for="safeMode">Android Safe Mode</label>
        <input type="checkbox" id="safeMode">
    </div>

    <footer>VR Explorer 1.1 brought to you by Cambridge VR</footer>
</div>

<div id="playerWrap"></div>

<script>
// ------------------- VIDEO DATA -------------------
const videos = {
  audience: {
    "Audience of 0": "8D5ZJjV-9No",
    "Audience of 1": "L61TY-lVWYc",
    "Audience of 2": "jisLJabMOaw",
    "Audience of 4": "583YioSTgGE",
    "Audience of 9": "7AS7NEA9PFo",
    "Audience of 16": "_y-lSw1SNaU",
    "Audience of 25": "CBBwXbX5ogE",
    "Audience of 50": "RUnKCfWFSfI",
    "Audience of 100": "ww986pYF46E",
    "Audience of 500": "S3Ve7FGfjWk",
    "Audience of 1000s": "jyUNFPBmJkA"
  },
  scenario: {
    "TV teleprompter": "3ZNddx_YNc0",
    "Job interview": "-tsxJfabw0s",
    "Radio interview": "sE3pahN4BwI"
  }
};

// ------------------- POPULATE DROPDOWNS -------------------
const audienceSel = document.getElementById("audienceSelect");
const scenarioSel = document.getElementById("scenarioSelect");
Object.keys(videos.audience).forEach(name => {
  const opt = document.createElement("option");
  opt.value = name;
  opt.textContent = name;
  audienceSel.appendChild(opt);
});
Object.keys(videos.scenario).forEach(name => {
  const opt = document.createElement("option");
  opt.value = name;
  opt.textContent = name;
  scenarioSel.appendChild(opt);
});

// ------------------- VARIABLES -------------------
const openBtn = document.getElementById("openBtn");
const safeModeCheck = document.getElementById("safeMode");
const playerWrap = document.getElementById("playerWrap");
let selectedVideoKey = "";

// ------------------- UPDATE SELECTION -------------------
function updateSelection() {
    const audience = audienceSel.value;
    const scenario = scenarioSel.value;
    selectedVideoKey = audience || scenario;
    if(selectedVideoKey) openBtn.classList.add("active");
    else openBtn.classList.remove("active");
}

audienceSel.addEventListener("change", ()=>{ scenarioSel.value=""; updateSelection(); });
scenarioSel.addEventListener("change", ()=>{ audienceSel.value=""; updateSelection(); });

// ------------------- OPEN VIDEO -------------------
openBtn.addEventListener("click", ()=>{
    if(!selectedVideoKey) return;

    // Determine which type
    let videoId = videos.audience[selectedVideoKey] || videos.scenario[selectedVideoKey];

    if(safeModeCheck.checked){
        // ---------------- SAFE MODE: YouTube iframe ----------------
        openSafeMode(videoId);
    } else {
        // ---------------- NORMAL VR ----------------
        openVR("https://player.virtualrealitypublicspeaking.com/?video=" + selectedVideoKey.replace(/ /g,'') + "-CF");
    }
});

// ------------------- NORMAL VR (Android / desktop) -------------------
function openVR(url){
    playerWrap.innerHTML="";
    const toolbar = document.createElement("div");
    toolbar.className="player-toolbar";
    const exitBtn = document.createElement("button");
    exitBtn.textContent="Exit VR";
    exitBtn.onclick = closePlayer;
    toolbar.appendChild(exitBtn);

    const iframe = document.createElement("iframe");
    iframe.src = url;
    iframe.allow = "autoplay; fullscreen; accelerometer; gyroscope; xr-spatial-tracking";
    playerWrap.appendChild(toolbar);
    playerWrap.appendChild(iframe);
    playerWrap.style.display="flex";
}

// ------------------- SAFE MODE -------------------
function openSafeMode(videoId){
    playerWrap.innerHTML="";
    const toolbar = document.createElement("div");
    toolbar.className="player-toolbar";
    const exitBtn = document.createElement("button");
    exitBtn.textContent="Exit";
    exitBtn.onclick = closePlayer;
    toolbar.appendChild(exitBtn);

    // Build YouTube embed URL
    const ytUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&loop=1&playlist=${videoId}&vq=hd2160`;
    const iframe = document.createElement("iframe");
    iframe.src = ytUrl;
    iframe.allow = "autoplay; fullscreen; accelerometer; gyroscope; vr";
    playerWrap.appendChild(toolbar);
    playerWrap.appendChild(iframe);
    playerWrap.style.display="flex";
}

// ------------------- CLOSE PLAYER -------------------
function closePlayer(){
    playerWrap.style.display="none";
    playerWrap.innerHTML="";
}

// ------------------- SERVICE WORKER -------------------
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("/ExplorerTest8/sw.js");
}
</script>

</body>
</html>
